/**
 * Tenlixor JavaScript SDK v1.0.0
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Tenlixor=t()}(this,function(){"use strict";class e{constructor(e={}){if(!e.token)throw new Error("Tenlixor: API token is required");this.config={token:e.token,language:e.language||"en",apiUrl:e.apiUrl||"https://api-tenlixor.verbytes.com/api/v1/strings",cache:!1!==e.cache,cacheTTL:e.cacheTTL||3e5,fallbackLanguage:e.fallbackLanguage||"en",autoScan:!1!==e.autoScan},this.data={tenant_id:null,languages:{}},this.listeners={loaded:[],error:[],"language-changed":[]},this.isInitialized=!1,this.currentLanguage=this.config.language,this.isLoading=!1}async init(){if(!this.isLoading){this.isLoading=!0;try{await this.fetchStrings(this.currentLanguage),this.isInitialized=!0,this.config.autoScan&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.scan()):this.scan()),this.emit("loaded",{language:this.currentLanguage})}catch(e){this.emit("error",{code:"INIT_FAILED",message:e.message,error:e})}finally{this.isLoading=!1}}}async fetchStrings(e){if(this.config.cache){const t=this.getFromCache(e);if(t)return this.mergeData(t),t}try{const t=`${this.config.apiUrl}?language_code=${encodeURIComponent(e)}`,a=await fetch(t,{method:"GET",headers:{Authorization:`Bearer ${this.config.token}`,"Content-Type":"application/json"}});if(!a.ok){if(401===a.status)throw new Error("UNAUTHORIZED: Invalid API token");throw new Error(`HTTP ${a.status}: ${a.statusText}`)}const n=await a.json();if(!n.success)throw new Error("API returned success: false");return n.data.tenant_id&&(this.data.tenant_id=n.data.tenant_id),this.mergeData(n.data),this.config.cache&&this.saveToCache(e,n.data),n.data}catch(t){if(this.config.cache){const a=this.getFromCache(e,!0);if(a)return this.mergeData(a),a}throw t}}mergeData(e){e.languages&&Array.isArray(e.languages)&&e.languages.forEach(e=>{const t={};e.resources&&Array.isArray(e.resources)&&e.resources.forEach(e=>{t[e.key]=e.value}),this.data.languages[e.code]=t})}t(e,t){const a=t||this.currentLanguage;return this.data.languages[a]&&this.data.languages[a][e]?this.data.languages[a][e]:a!==this.config.fallbackLanguage&&this.data.languages[this.config.fallbackLanguage]&&this.data.languages[this.config.fallbackLanguage][e]?this.data.languages[this.config.fallbackLanguage][e]:e}async setLanguage(e){if(e===this.currentLanguage)return;const t=this.currentLanguage;this.currentLanguage=e;try{await this.fetchStrings(e),this.scan(),this.emit("language-changed",{from:t,to:e})}catch(a){throw this.currentLanguage=t,this.emit("error",{code:"LANGUAGE_CHANGE_FAILED",message:a.message,error:a}),a}}async reload(){this.config.cache&&this.clearCache(this.currentLanguage),await this.fetchStrings(this.currentLanguage),this.scan(),this.emit("loaded",{language:this.currentLanguage,reloaded:!0})}scan(){if(!this.isInitialized)return;const e=this.currentLanguage;document.querySelectorAll("[data-txr-key]").forEach(t=>{const a=t.getAttribute("data-txr-key");if(a&&!t.hasAttribute("data-txr-resolved")){const n=this.t(a,e);t.textContent=n,t.setAttribute("data-txr-resolved","true"),t.setAttribute("data-txr-lang",e)}else if(a&&t.getAttribute("data-txr-lang")!==e){const n=this.t(a,e);t.textContent=n,t.setAttribute("data-txr-lang",e)}}),this.scanTextNodes(document.body,e)}scanTextNodes(e,t){if(e&&(e.nodeType!==Node.ELEMENT_NODE||!e.hasAttribute("data-txr-resolved")))if(e.nodeType===Node.TEXT_NODE){const a=e.textContent.trim();if(a&&this.data.languages[t]&&this.data.languages[t][a]){const n=this.t(a,t);e.textContent=n,e.parentElement&&(e.parentElement.setAttribute("data-txr-resolved","true"),e.parentElement.setAttribute("data-txr-key",a),e.parentElement.setAttribute("data-txr-lang",t))}}else if(e.nodeType===Node.ELEMENT_NODE){const a=e.tagName.toLowerCase();"script"!==a&&"style"!==a&&"noscript"!==a&&e.childNodes.forEach(e=>this.scanTextNodes(e,t))}}on(e,t){this.listeners[e]&&"function"==typeof t&&this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>{try{e(t)}catch(e){console.error(`Tenlixor: Error in ${event} listener:`,e)}})}getFromCache(e,t=!1){const a=this.getCacheKey(e);try{if("undefined"!=typeof localStorage){const n=localStorage.getItem(a);if(n){const a=JSON.parse(n);if(t||Date.now()-a.timestamp<this.config.cacheTTL)return a.data}}if(this._memoryCache&&this._memoryCache[a]){const n=this._memoryCache[a];if(t||Date.now()-n.timestamp<this.config.cacheTTL)return n.data}}catch(e){console.warn("Tenlixor: Cache read error:",e)}return null}saveToCache(e,t){const a=this.getCacheKey(e),n={timestamp:Date.now(),data:t};try{"undefined"!=typeof localStorage&&localStorage.setItem(a,JSON.stringify(n)),this._memoryCache||(this._memoryCache={}),this._memoryCache[a]=n}catch(e){console.warn("Tenlixor: Cache write error:",e)}}clearCache(e){const t=this.getCacheKey(e);try{"undefined"!=typeof localStorage&&localStorage.removeItem(t),this._memoryCache&&this._memoryCache[t]&&delete this._memoryCache[t]}catch(e){console.warn("Tenlixor: Cache clear error:",e)}}getCacheKey(e){return`txr_${this.data.tenant_id||"default"}_${e}`}getLanguage(){return this.currentLanguage}getAvailableLanguages(){return Object.keys(this.data.languages)}isReady(){return this.isInitialized}}return e});
